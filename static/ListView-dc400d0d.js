var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{C as i,M as s}from"./CommonHander-85829c56.js";import{P as a,M as o}from"./MyTable-9b9835b0.js";import{i as n,f as r,ac as l,q as h,A as d,am as c}from"./index-ab1010d4.js";import{P as u}from"./PageBase-a3e7a0c4.js";const f="_tableActBox_1soxi_1",m="_action_1soxi_6",g="_searchBox_1rzgo_1",p="_form_1rzgo_32",b="_action_1rzgo_37",C=new class extends u{constructor(){super(...arguments),e(this,"emits",["reset","search"])}render(){return n("div",{class:[g,"box"]},[n(r("el-form"),{ref:"form",inline:!0,class:["flex1",p],onKeyup:l((()=>this.$emit("search")),["enter"]),"label-width":"auto",onSubmit:h((()=>{}),["prevent"])},{default:()=>[this.$slots.default&&this.$slots.default(),n(r("el-form-item"),{class:b},{default:()=>[this.$slots.btns&&this.$slots.btns(),n(r("el-button"),{type:"primary",onClick:()=>this.$emit("search")},{default:()=>[d("查询")]}),n(r("el-button"),{type:"default",onClick:()=>this.$emit("reset")},{default:()=>[d("重置")]})]})]})])}},y=new class extends u{constructor(){super(),e(this,"props",{api:{type:Object},method:Object,query:{type:Object},resetQuery:Function,tableConfig:{type:Object,default:()=>({})},dialogConfig:Object,addHandler:Function,editHandler:Function,notAdd:Boolean,idKey:{type:String,default:"id"}}),e(this,"expose",["refresh","handler"]),e(this,"emits",["selectionChange"]),e(this,"pager",null),e(this,"handler",null),e(this,"columns",{}),e(this,"buttonSize","default")}async created(){this.pager=new a(this.api,this.method||this.api.page,(()=>this.query)),this.pager.onError=t=>!0,this.handler=new i(this.api,this.pager),await this.refresh()}render(){return n("div",{class:"app-container"},[this.searchNode(),n("div",{class:"mainBox"},[n("div",{class:f},[n("div",{class:m},[!this.notAdd&&n(r("el-button"),{type:"primary",icon:c,size:this.buttonSize,onClick:()=>this.add()},{default:()=>[d("新增")]}),this.$slots.tableHeadAct&&this.$slots.tableHeadAct()])]),n(s,{loadStatus:this.handler.loadStatus,error:this.handler.error},{default:()=>{var t;return[n(o,{tableData:this.pager,columns:this.columns,actionConfig:(null==(t=this.tableConfig)?void 0:t.actionConfig)||{width:"120"},onSelectionChange:this.selectionChange},{actionSlot:this.actionSlot})]}})])])}searchNode(){var t,e;const i=null==(e=(t=this.$slots).searchItems)?void 0:e.call(t);if(i||Array.isArray(i)&&i.length>0)return n(C,{onSearch:()=>this.refresh(),onReset:()=>this.reset()},{default:()=>i,btns:this.$slots.searchBtns})}actionSlot(t){return[this.$slots.tableAction&&this.$slots.tableAction(t),!this.tableConfig.notEdit&&n(r("el-button"),{type:"primary",link:!0,onClick:()=>this.edit(t.row)},{default:()=>[d("编辑")]}),!this.tableConfig.notDel&&n(r("el-button"),{type:"primary",link:!0,onClick:()=>this.delete(t.row)},{default:()=>[d("删除")]})]}async refresh(){await this.handler.refresh(),this.buildCol()}buildCol(){var t;this.columns={},(null==(t=this.tableConfig)?void 0:t.setColumns)?this.tableConfig.setColumns(this.columns):this.$alert("请配置表头")}add(){this.addHandler?this.addHandler():this.addOrEdit()}edit(t){this.editHandler?this.editHandler(t):this.addOrEdit(t)}addOrEdit(t){if(this.dialogConfig){const e=new this.dialogConfig.editDialog;let i={onConfirm:async t=>this.handler.addOrEdit(t)};this.dialogConfig.editConfig&&(i={...this.dialogConfig.editConfig,onConfirm:this.dialogConfig.editConfig.onConfirm||i.onConfirm}),e.show(t,i)}}delete(t){this.handler.confirmAction("是否删除此数据?",t[this.idKey].toString())}reset(){for(const t in this.query)this.query[t]=null;this.resetQuery&&(this.query=this.resetQuery()),this.pager.reset(this.query),this.handler.refresh()}selectionChange(t){this.$emit("selectionChange",t)}};export{y as L};
