var t=Object.defineProperty,e=(e,r,s)=>(((e,r,s)=>{r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s})(e,"symbol"!=typeof r?r+"":r,s),s);import{b as r,i as s,f as a,av as i,E as o}from"./index-ab1010d4.js";import{M as n}from"./Loading-c7a91146.js";import{h as l}from"./MyTable-9b9835b0.js";let h=function(t){return t[t.loading=0]="loading",t[t.success=1]="success",t[t.failed=2]="failed",t[t.empty=3]="empty",t}({});const c=r({props:{loadStatus:{type:Number,required:!0},error:{type:String},desc:String},render(){return this.loadStatus==h.success?this.$slots.default(this):this.loadStatus==h.failed||this.error?s(a("el-empty"),{class:"pageError",description:this.error||"获取失败,请稍后重试"},null):this.loadStatus==h.empty?s(a("el-empty"),{description:this.desc||"暂无数据"},null):s(a("el-skeleton"),{row:6,animated:!0,throttle:100},null)}});class u{constructor(t,r){e(this,"api"),e(this,"pager"),e(this,"_loadStatus",h.loading),e(this,"_error",null),e(this,"onStatusChange"),e(this,"onError"),this.api=t,this.pager=r}get loadStatus(){return this._loadStatus}get error(){return this._error}confirmAction(t,e,r,s=!0){i.confirm(t,"警告").then((async()=>{const t=new n;try{"function"==typeof e?await e():"string"==typeof e&&(await this.api.delete(e),o.success("删除成功")),s&&this.pager&&this.refresh(),"function"==typeof r&&r()}catch(a){i.alert(`${a}`,{type:"error"})}finally{t.close()}})).catch((()=>{}))}async refresh(t,e){this._loadStatus=h.loading;try{this.pager?(await this.pager.refresh(),"function"==typeof t&&await t(),1==this.pager.currentPage&&(this._loadStatus=this.pager.items.length?h.success:h.empty)):"function"==typeof t&&(await t(),this._loadStatus=h.success),"function"==typeof e&&e()}catch(r){if(this.pager)if(1==this.pager.currentPage){if(this._loadStatus=h.failed,this._error=r,!this.onError||!this.onError(r))throw r}else i.alert(`${r}`,{type:"error"});else if(this._loadStatus=h.failed,this._error=r,!this.onError||!this.onError(r))throw r}finally{this.onStatusChange&&this.onStatusChange(this._loadStatus)}}async addOrEdit(t,e="id"){var r,s;const a=new n;try{return await(null==(s=(r=this.api)[l(t,e)?"edit":"add"])?void 0:s.call(r,t)),o.success("操作成功"),this.refresh(),!0}catch(h){i.alert(`${h}`,{type:"error"})}finally{a.close()}}}export{u as C,c as M};
